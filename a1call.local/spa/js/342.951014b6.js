"use strict";(globalThis["webpackChunkquasar_project"]=globalThis["webpackChunkquasar_project"]||[]).push([[342],{2409:(e,a,l)=>{l.d(a,{f:()=>n});var t=l(7363);const n=(0,t.Q_)("loader",{state:()=>({counter:0}),getters:{isLoading:e=>e.counter>0},actions:{on(){this.counter++},off(){this.counter>0&&this.counter--}}})},6342:(e,a,l)=>{l.r(a),l.d(a,{default:()=>D});var t=l(9835),n=l(6970);const o={class:"fit"},i=(0,t._)("div",{class:"col-2 q-table__title"},"Список транзакций",-1),s=(0,t._)("span",{class:"text-caption q-mr-sm"},"Записей на странице: ",-1),r={class:"text-caption q-mr-sm"};function u(e,a,l,u,c,d){const g=(0,t.up)("q-space"),m=(0,t.up)("q-select"),p=(0,t.up)("q-btn"),f=(0,t.up)("q-btn-group"),b=(0,t.up)("q-td"),_=(0,t.up)("q-table"),v=(0,t.up)("q-page");return(0,t.wg)(),(0,t.j4)(v,{padding:"",class:"flex flex-center"},{default:(0,t.w5)((()=>[(0,t._)("div",o,[(0,t.Wm)(_,{ref:"tableRef",class:"my-sticky-header-table",style:(0,n.j5)(e.inFullscreen?"max-height: 80vh;":"max-height: 100vh;"),title:"Treats","row-key":"id","binary-state-sort":"","wrap-cells":"",pagination:e.pagination,"onUpdate:pagination":a[2]||(a[2]=a=>e.pagination=a),loading:e.loading,filter:e.filter,onRequest:e.onRequest,rows:e.rows,columns:e.columns,"visible-columns":e.visibleColumns},{top:(0,t.w5)((l=>[i,(0,t.Wm)(g),(0,t.Wm)(m,{modelValue:e.visibleColumns,"onUpdate:modelValue":a[0]||(a[0]=a=>e.visibleColumns=a),multiple:"",outlined:"",dense:"","options-dense":"","display-value":"Показать cтолбцы","emit-value":"","map-options":"",options:e.columns,"option-value":"name","options-cover":"",style:{"min-width":"150px"}},null,8,["modelValue","options"]),(0,t.Wm)(p,{flat:"",round:"",dense:"",icon:l.inFullscreen?"fullscreen_exit":"fullscreen",onClick:a=>e.toggleFullscreen(l),class:"q-ml-md"},null,8,["icon","onClick"])])),"body-cell-action":(0,t.w5)((a=>[(0,t.Wm)(b,null,{default:(0,t.w5)((()=>[(0,t.Wm)(f,{push:""},{default:(0,t.w5)((()=>[(0,t.Wm)(p,{disable:e.loading||"PAID"==a.row.status,size:"sm",push:"",color:"positive",icon:"verified",title:"Подтвердить оплату",onClick:l=>e.action_pay(a.rowIndex,a.row)},null,8,["disable","onClick"]),(0,t.Wm)(p,{disable:e.loading,size:"sm",push:"",color:"negative",icon:"delete",title:"Удалить",onClick:l=>e.action_remove(a.rowIndex)},null,8,["disable","onClick"])])),_:2},1024)])),_:2},1024)])),"body-cell-tariff_ext":(0,t.w5)((e=>[(0,t.Wm)(b,{props:e,innerHTML:e.value},null,8,["props","innerHTML"])])),bottom:(0,t.w5)((l=>[(0,t.Wm)(g),s,(0,t.Wm)(m,{dense:"",borderless:"",modelValue:e.pagination.rowsPerPage,"onUpdate:modelValue":[a[1]||(a[1]=a=>e.pagination.rowsPerPage=a),e.setPagination],options:e.optionsRowsPerPage,class:"q-mr-md"},null,8,["modelValue","onUpdate:modelValue","options"]),l.pagesNumber>2?((0,t.wg)(),(0,t.j4)(p,{key:0,icon:"first_page",color:"grey-8",round:"",dense:"",flat:"",disable:l.isFirstPage,onClick:l.firstPage},null,8,["disable","onClick"])):(0,t.kq)("",!0),(0,t.Wm)(p,{icon:"chevron_left",color:"grey-8",round:"",dense:"",flat:"",disable:l.isFirstPage,onClick:l.prevPage},null,8,["disable","onClick"]),(0,t._)("span",r,(0,n.zw)(l.pagination.page)+"/"+(0,n.zw)(l.pagesNumber),1),(0,t.Wm)(p,{icon:"chevron_right",color:"grey-8",round:"",dense:"",flat:"",disable:l.isLastPage,onClick:l.nextPage},null,8,["disable","onClick"]),l.pagesNumber>2?((0,t.wg)(),(0,t.j4)(p,{key:1,icon:"last_page",color:"grey-8",round:"",dense:"",flat:"",disable:l.isLastPage,onClick:l.lastPage},null,8,["disable","onClick"])):(0,t.kq)("",!0)])),"top-right":(0,t.w5)((()=>[])),_:1},8,["style","pagination","loading","filter","onRequest","rows","columns","visible-columns"])])])),_:1})}l(4110),l(702);var c=l(499),d=l(9302),g=(l(6827),l(1569)),m=l(2409);const p=[{name:"user_email",required:!0,label:"Email",align:"left",field:e=>e.user_email,format:e=>`${e}`,sortable:!0},{name:"user_fullname",align:"left",label:"Полное имя",field:"user_fullname",sortable:!0},{name:"order_id",align:"center",label:"ID заказа",field:"order_id",sortable:!0},{name:"id",align:"center",label:"ID транзакции",field:"id",sortable:!0},{name:"gateway_id",align:"center",label:"ID в платежном шлюзе",field:"gateway_id",sortable:!0},{name:"gateway_name",align:"center",label:"Платежный шлюз",field:"gateway_name",sortable:!0},{name:"gateway_system",align:"center",label:"Платежная система",field:"gateway_system",sortable:!0},{name:"tariff_name",label:"Тариф",align:"left",field:e=>e.order_tariff.name,format:e=>`${e}`,sortable:!1},{name:"tariff_country",label:"Страна",align:"left",field:e=>e.order_tariff.country.label,format:e=>`${e}`,sortable:!1},{name:"tariff_days",label:"Длительность подписки",align:"left",field:e=>e.order_tariff.monthAmount.label,format:e=>`${e}`,sortable:-2},{name:"order_connect_amount",align:"center",label:"Количество подключений",field:"order_connect_amount",sortable:!0},{name:"tariff_ext",label:"Доп. данные",align:"left",field:e=>e.order_tariff_extdata,format:e=>{let a="";if(null!==e&&void 0!==e&&e.contacts){const l=e.contacts;a+='<span class="text-caption">Контакты: </span><br>';for(const e in l)a+=`${l[e]} <br>`}const l=null===e||void 0===e?void 0:e.static;return"undefined"!==typeof l&&null!==l&&(a+='<span class="text-caption">IP-адресс: </span>',!0===l?a+="статический":!1===l&&(a+="динамический")),a},sortable:!1},{name:"createDate",align:"center",label:"Время создания транзакции",field:"createDate",sortable:!0},{name:"order_createDate",align:"center",label:"Время создания тарифа",field:"order_createDate",sortable:!0},{name:"order_start",align:"left",label:"Дата начала действия тарифа",field:"order_start",sortable:!0},{name:"order_expires",align:"left",label:"Дата окончания действия тарифа",field:"order_expires",sortable:!0},{name:"paid_amount",align:"center",label:"Пользователь оплатил",field:"paid_amount",sortable:!0},{name:"request_amount",align:"center",label:"Запрошенная сумма",field:"request_amount",sortable:!0},{name:"order_status",align:"left",label:"Статус заказа",field:"order_status",sortable:!0},{name:"status",align:"left",label:"Статус транзакции",field:"status",sortable:!0},{name:"action",align:"center",label:"Действие",field:e=>e.id,sortable:!1}],f=(0,t.aZ)({name:"ManagerPage",components:{},setup(){(0,d.Z)();const e=(0,m.f)(),a=(0,t.Fl)((()=>e.isLoading)),l=(0,c.iH)(!0),n=(0,c.iH)(),o=(0,c.iH)([]),i=(0,c.iH)(""),s=(0,c.iH)(!1),r=[5,10,25,50,100],u=(0,c.iH)({sortBy:"createDate",descending:!1,page:1,rowsPerPage:10,rowsNumber:10});function f(e){l.value=e.inFullscreen,e.toggleFullscreen()}function b(e){const{page:a,rowsPerPage:l,sortBy:t,descending:n}=e.pagination;e.filter;s.value=!0,g.api.get("/manager.php",{params:e.pagination}).then((e=>{const a=(null===e||void 0===e?void 0:e.data)||null;if(!a)return void console.log("[ GET manager.php ] Ошибка получения данных с сервера");const{total:l,pageCount:t,limit:n,page:i,sortby:s,descending:c,data:d}=a;console.log("data: ",d),-1==r.indexOf(n)&&(r.push(n),r.sort((function(e,a){return e-a}))),u.value.rowsNumber=l,u.value.page=i,u.value.rowsPerPage=n,u.value.sortBy=s,u.value.descending=c,o.value.splice(0,o.value.length,...d)})).catch((e=>{console.log("manager catch: ",e)})).finally((()=>{s.value=!1}))}function _(e){u.value.rowsPerPage=e,n.value.setPagination(u.value,!0)}(0,t.bv)((()=>{b({pagination:u.value,filter:void 0})})),r.push();const v=e=>{o.value=o.value.map((a=>(a.order_id==e.id&&(a.order_expires=e.expires,a.order_status=e.status),a)))};let w=0;const y=(e,a)=>{w++,s.value=!0,g.api.post("/manager.php",{action:"pay",id:a.id}).then((e=>{v(e.data),a.paid_amount=a.request_amount,a.status="PAID"})).catch((e=>{console.log("manager pay catch: ",e)})).finally((()=>{0==--w&&(s.value=!1)}))},h=e=>{s.value=!0;const a=o.value[e];g.api.post("/manager.php",{action:"remove",id:a.id}).then((a=>{o.value=[...o.value.slice(0,e),...o.value.slice(e+1)],v(a.data),u.value.rowsNumber=o.value.length})).catch((e=>{console.log("manager remove catch: ",e)})).finally((()=>{s.value=!1}))};return{action_pay:y,action_remove:h,tableRef:n,optionsRowsPerPage:r,setPagination:_,toggleFullscreen:f,inFullscreen:l,isLoading:a,filter:i,loading:s,pagination:u,columns:p,rows:o,onRequest:b,visibleColumns:(0,c.iH)(["user_email","gateway_id","gateway_name","gateway_system","tariff_ext","tariff_name","order_expires","paid_amount","request_amount","order_status","status","action"])}}});var b=l(1639),_=l(9885),v=l(7580),w=l(136),y=l(6945),h=l(4455),P=l(7220),q=l(7236),k=l(6611),x=l(2857),C=l(9984),W=l.n(C);const Z=(0,b.Z)(f,[["render",u]]),D=Z;W()(f,"components",{QPage:_.Z,QTable:v.Z,QSpace:w.Z,QSelect:y.Z,QBtn:h.Z,QTd:P.Z,QBtnGroup:q.Z,QInput:k.Z,QIcon:x.Z})}}]);